<!DOCTYPE html>
<html>
  <head>
    <title>NearStarXR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@^4.0.0/dist/aframe-event-set-component.min.js"></script>
  </head>
  <body>
    <a-scene background="color: #111">
      <a-entity id="stars-container"></a-entity>
      <a-entity id="camera-rig">
          <a-camera>
              <a-cursor color="#FFF"></a-cursor>
              <a-text id="star-label" value="" position="0 -0.5 -1" align="center"></a-text>
          </a-camera>
      </a-entity>
    </a-scene>

    <script>
      // --- Star Data and Colors ---
      const spectralColors = { 'O': '#9bb0ff', 'B': '#aabfff', 'A': '#cad8ff', 'F': '#f8f7ff', 'G': '#fff4ea', 'K': '#ffd2a1', 'M': '#ffb568', 'D': '#FFFFFF' };
      const getStarColor = (spectralType) => {
        const type = spectralType.charAt(0).toUpperCase();
        return spectralColors[type] || '#FFFFFF';
      };

      // --- Fetch and Render Stars ---
      window.addEventListener('load', () => {
        fetch('/api/stars')
          .then(response => response.json())
          .then(stars => {
            const container = document.getElementById('stars-container');
            stars.forEach(star => {
              if (star.Star === 'Sun') return; // Don't render the sun at 0,0,0

              const starEntity = document.createElement('a-sphere');
              starEntity.setAttribute('position', `${star.x} ${star.z} ${-star.y}`); // A-Frame is Y-up, so we swap z and y
              starEntity.setAttribute('radius', '0.1'); // Simple radius for now
              starEntity.setAttribute('color', getStarColor(star.SpectralType));
              
              // Add glow
              starEntity.setAttribute('material', 'shader: standard; emissive: ' + getStarColor(star.SpectralType) + '; emissiveIntensity: 0.6');
              
              // Add interactivity
              starEntity.setAttribute('event-set__enter', `_event: mouseenter; _target: #star-label; value: ${star.Star}`);
              starEntity.setAttribute('event-set__leave', `_event: mouseleave; _target: #star-label; value: `);

              container.appendChild(starEntity);
            });
          });
      });
    </script>
  </body>
</html>